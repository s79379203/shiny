nkgprofitA <- nkgoutputA - nkgcostA
renderValueBox({
nkgrate <- formatC(nkgoutputA, digits = 2, format = "f")
valueBox(
value = nkgrate,
icon = "fa-area-chart",
color = if (nkgrate < 0.2) "warning" else "primary"
)
})
#ClientNo=="04370927"
#ClientNo=="27580987-1"
#ClientNo=="27580987-4"
#ClientNo=="27580987-5"
nkg_allA <- subset(sqlResultall,ClientNo=="04370927" |
ClientNo=="27580987-1" |
ClientNo=="27580987-4" |
ClientNo=="27580987-5")
valueBox(nkgoutputA <- round(sum(nkg_allA$samt) / 10000))
load("C:/Users/elvis/Documents/fwt_reports/fwtdata.RData")
valueBox(totaloutput <- round(sum(sqlResultall$samt) / 10000))
valueBox(round(totaloutput/6))
#totalcost <- round(sum(sqlResultall$scost) / 10000)
#valueBox((totaloutput-totalcost) / totaloutput)
totaloutput <- round(sum(sqlResultall$samt) / 10000)
totalcost <- round(sum(sqlResultall$scost) / 10000)
totalprofit <- totaloutput - totalcost
renderValueBox({
rate <- formatC(totalprofit / totaloutput, digits = 2, format = "f")
valueBox(
value = rate,
icon = "fa-area-chart",
color = if (rate < 0.2) "warning" else "primary"
)
})
#ClientNo=="04370927"
#ClientNo=="27580987-1"
#ClientNo=="27580987-4"
#ClientNo=="27580987-5"
nkg_allA <- subset(sqlResultall,ClientNo=="04370927" |
ClientNo=="27580987-1" |
ClientNo=="27580987-4" |
ClientNo=="27580987-5")
valueBox(nkgoutputA <- round(sum(nkg_allA$samt) / 10000))
#totalcost <- round(sum(sqlResultall$scost) / 10000)
#valueBox((totaloutput-totalcost) / totaloutput)
nkgoutputA <- round(sum(nkg_allA$samt) / 10000)
nkgcostA <- round(sum(nkg_allA$scost) / 10000)
nkgprofitA <- nkgoutputA - nkgcostA
renderValueBox({
nkgrate <- formatC(nkgoutputA, digits = 2, format = "f")
valueBox(
value = nkgrate,
icon = "fa-area-chart",
color = if (nkgrate < 0.2) "warning" else "primary"
)
})
View(nkg_allA)
#ClientNo=="04370927"
#ClientNo=="27580987-1"
#ClientNo=="27580987-4"
#ClientNo=="27580987-5"
nkg_allA <- subset(sqlResultall,ClientNo=="04370927" |
ClientNo=="27580987-1" |
ClientNo=="27580987-4" |
ClientNo=="27580987-5")
valueBox(nkgoutputA <- round(sum(nkg_allA$samt) / 10000))
#totalcost <- round(sum(sqlResultall$scost) / 10000)
#valueBox((totaloutput-totalcost) / totaloutput)
#nkgoutputA <- round(sum(nkg_allA$samt) / 10000)
nkgcostA <- round(sum(nkg_allA$scost) / 10000)
nkgprofitA <- nkgoutputA - nkgcostA
renderValueBox({
rate <- formatC(sum(nkg_allA$samt), digits = 2, format = "f")
valueBox(
value = rate,
icon = "fa-area-chart",
color = if (rate < 0.2) "warning" else "primary"
)
})
nkgcostA
nkgoutputA
View(nkg_allA)
sum(nkg_allA$samt)
nkgoutput
load("C:/Users/elvis/Documents/fwt_reports/fwtdata.RData")
valueBox(totaloutput <- round(sum(sqlResultall$samt) / 10000))
valueBox(round(totaloutput/6))
#totalcost <- round(sum(sqlResultall$scost) / 10000)
#valueBox((totaloutput-totalcost) / totaloutput)
totaloutput <- round(sum(sqlResultall$samt) / 10000)
totalcost <- round(sum(sqlResultall$scost) / 10000)
totalprofit <- totaloutput - totalcost
renderValueBox({
rate <- formatC(totalprofit / totaloutput, digits = 2, format = "f")
valueBox(
value = rate,
icon = "fa-area-chart",
color = if (rate < 0.2) "warning" else "primary"
)
})
#ClientNo=="04370927"
#ClientNo=="27580987-1"
#ClientNo=="27580987-4"
#ClientNo=="27580987-5"
nkg_allA <- subset(sqlResultall,ClientNo=="04370927" |
ClientNo=="27580987-1" |
ClientNo=="27580987-4" |
ClientNo=="27580987-5")
valueBox(nkgoutputA <- round(sum(nkg_allA$samt) / 10000))
#totalcost <- round(sum(sqlResultall$scost) / 10000)
#valueBox((totaloutput-totalcost) / totaloutput)
nkgoutputA <- round(sum(nkg_allA$samt) / 10000)
nkgcostA <- round(sum(nkg_allA$scost) / 10000)
nkgprofitA <- nkgoutputA - nkgcostA
renderValueBox({
rate <- formatC(nkgoutputA, digits = 2, format = "f")
valueBox(
value = rate,
icon = "fa-area-chart",
color = if (rate < 0.2) "warning" else "primary"
)
})
#27580987-1 CAL-COMP
#04370927 金寶電子
#27580987-4 泰金寶光電(岳陽)
#ClientNo=="27580987-1"
#ClientNo=="04370927"
#ClientNo=="27580987-4"|
nkg_allC <- subset(sqlResultall,ClientNo=="27580987-1")
valueBox(nkgoutputC <- round(sum(nkg_allC$samt) / 10000))
#27580987-1 CAL-COMP
#04370927 金寶電子
#27580987-4 泰金寶光電(岳陽)
#ClientNo=="27580987-1"
#ClientNo=="04370927"
#ClientNo=="27580987-4"|
nkg_allD <- subset(sqlResultall,ClientNo=="27580987-5")
valueBox(nkgoutputD <- round(sum(nkg_allD$samt) / 10000))
#27580987-1 CAL-COMP
#04370927 金寶電子
#27580987-4 泰金寶光電(岳陽)
#ClientNo=="27580987-1
#ClientNo=="04370927"
#ClientNo=="27580987-4"|
nkg_allB <- subset(sqlResultall,ClientNo=="04370927")
valueBox(nkgoutputB <- round(sum(nkg_allB$samt) / 10000))
#27580987-1 CAL-COMP
#04370927 金寶電子
#27580987-4 泰金寶光電(岳陽)
#27580987-5 泰金寶(巴西)
#ClientNo=="27580987-1
#ClientNo=="04370927"
#ClientNo=="27580987-4"
#ClientNo==27580987-5
nkg_allA <- subset(sqlResultall,ClientNo=="27580987-4")
valueBox(nkgoutputA <- round(sum(nkg_allA$samt) / 10000))
require(plyr)
Shipbycust <- subset(sqlResultall, select= c(salesman,client,shipdate,samt))
Shipbycust <- ddply(Shipbycust,.(salesman),summarise,
Total = round(sum(samt)/10000), AVG= round(Total/6))
datatable(Shipbycust)
valueBox(totaloutput7 <- round(sum(sqlResultall7$samt) / 10000))
#ClientNo=="04370927"
#ClientNo=="27580987-1"
#ClientNo=="27580987-4"
#ClientNo=="27580987-5"
nkg_all <- subset(sqlResultall7,ClientNo=="04370927" |
ClientNo=="27580987-1" |
ClientNo=="27580987-4" |
ClientNo=="27580987-5")
valueBox(nkgoutput <- round(sum(nkg_all$samt) / 10000))
#27580987-1 CAL-COMP
#04370927 金寶電子
#27580987-4 泰金寶光電(岳陽)
#ClientNo=="27580987-1"
#ClientNo=="04370927"
#ClientNo=="27580987-4"|
nkg_allC <- subset(sqlResultall7,ClientNo=="27580987-1")
valueBox(nkgoutputC <- round(sum(nkg_allC$samt) / 10000))
#27580987-1 CAL-COMP
#04370927 金寶電子
#27580987-4 泰金寶光電(岳陽)
#ClientNo=="27580987-1"
#ClientNo=="04370927"
#ClientNo=="27580987-4"|
nkg_allD <- subset(sqlResultall7,ClientNo=="27580987-5")
valueBox(nkgoutputD <- round(sum(nkg_allD$samt) / 10000))
#27580987-1 CAL-COMP
#04370927 金寶電子
#27580987-4 泰金寶光電(岳陽)
#ClientNo=="27580987-1
#ClientNo=="04370927"
#ClientNo=="27580987-4"|
nkg_allB <- subset(sqlResultall7,ClientNo=="04370927")
valueBox(nkgoutputB <- round(sum(nkg_allB$samt) / 10000))
#27580987-1 CAL-COMP
#04370927 金寶電子
#27580987-4 泰金寶光電(岳陽)
#ClientNo=="27580987-1
#ClientNo=="04370927"
#ClientNo=="27580987-4"|
nkg_allB <- subset(sqlResultall7,ClientNo=="04370927")
valueBox(nkgoutputB <- round(sum(nkg_allB$samt) / 10000))
#27580987-1 CAL-COMP
#04370927 金寶電子
#27580987-4 泰金寶光電(岳陽)
#27580987-5 泰金寶(巴西)
#ClientNo=="27580987-1
#ClientNo=="04370927"
#ClientNo=="27580987-4"
#ClientNo==27580987-5
nkg_allA <- subset(sqlResultall7,ClientNo=="27580987-4")
valueBox(nkgoutputA <- round(sum(nkg_allA$samt) / 10000))
#27580987-1 CAL-COMP
#04370927 金寶電子
#27580987-4 泰金寶光電(岳陽)
#27580987-5 泰金寶(巴西)
#ClientNo=="27580987-1
#ClientNo=="04370927"
#ClientNo=="27580987-4"
#ClientNo==27580987-5
nkg_allA <- subset(sqlResultall7,ClientNo=="27580987-4")
valueBox(nkgoutputA <- round(sum(nkg_allA$samt) / 10000))
#totalcost <- round(sum(sqlResultall$scost) / 10000)
#valueBox((totaloutput-totalcost) / totaloutput)
nkgoutputall <- round(sum(nkg_allA$samt) / 10000)
nkgcostall <- round(sum(nkg_allA$scost) / 10000)
nkgprofitall <- nkgoutputall - nkgcostall
renderValueBox({
nkgrate <- formatC( nkgprofitall / nkgoutputall, digits = 2, format = "f")
valueBox(
value = nkgrate,
icon = "fa-area-chart",
color = if (rate < 0.2) "warning" else "primary"
)
})
rmarkdown::render("fwt_dashboards.Rmd")
rmarkdown::render("fwt_dashboards.Rmd")
rmarkdown::render("fwt_dashboards.Rmd")
# merge the output of TP and HK
sqlResultall <- rbind(sqlResult, sqlResult13)
library("writexl")
require(RODBC)
#20180720測試:連結大帳省ERP資料庫
#除了上面用merge方式取得ERP出貨資料, 亦可直接使用sql語法直接讀取出貨資料
#open the ODBC connection
ch <- odbcConnect("N_ERP",uid="sa",pwd="intron")
#台北的資料庫為Icompany8
sqlResult <- sqlQuery(ch, "SELECT
Pact.actDate AS 'shipdate',
Card.no As 'ClientNo',
Card.name AS 'client',
SubShip.name AS 'partno',
vary.amountUI*ship.moneyDB AS 'samt',
Vary.vol*-1 AS 'sqty',
Vary.cost AS 'Runitprice',
vary.vol*vary.cost*-1 AS 'scost',
Ship.agent AS 'salesno',
Card_1.name AS 'salesman'
FROM ICompany8.dbo.Card Card,                                         ICompany8.dbo.Card Card_1,
ICompany8.dbo.Pact Pact,
ICompany8.dbo.Ship Ship,
ICompany8.dbo.SubShip SubShip,                                        ICompany8.dbo.Vary Vary
WHERE Ship.pact = Pact.pact AND                                       Vary.vary = SubShip.vary AND
Vary.pact = Pact.pact AND
Card.card = Ship.who AND
Ship.agent = Card_1.card
AND
((Card.kind=-1) AND
(Pact.ui=30) AND
(Pact.actDate>={ts '2021-01-01 00:00:00'})
)")
#讀取HK資料庫Icompany13
sqlResult13 <- sqlQuery(ch, "SELECT Pact.actDate AS 'shipdate',
Card.no As 'ClientNo',
Card.name AS 'client',
SubShip.name AS 'partno',
vary.amountUI*ship.moneyDB AS 'samt',
Vary.vol*-1 AS 'sqty',
Vary.cost AS 'Runitprice',
vary.vol*vary.cost*-1 AS 'scost',
Ship.agent AS 'salesno',
Card_1.name AS 'salesman'
FROM ICompany13.dbo.Card Card,
ICompany13.dbo.Card Card_1,
ICompany13.dbo.Pact Pact,
ICompany13.dbo.Ship Ship,
ICompany13.dbo.SubShip SubShip,
ICompany13.dbo.Vary Vary
WHERE Ship.pact = Pact.pact AND
Vary.vary = SubShip.vary AND
Vary.pact = Pact.pact AND
Card.card = Ship.who AND
Ship.agent = Card_1.card AND
((Card.kind=-1) AND (Pact.ui=30) AND
(Pact.actDate>={ts '2021-01-01 00:00:00'})
)")
# merge the output of TP and HK
sqlResultall <- rbind(sqlResult, sqlResult13)
# subset the
sqlResultall7 <- subset(sqlResultall, sqlResultall$shipdate >='2021-07-01 00:00:00')
# close the ODBC connection
odbcClose(ch)
#20210716 This R script will connect the ERP server
#Get shipment records and save to a RData for FWT dashboard
library("writexl")
require(RODBC)
#20180720測試:連結大帳省ERP資料庫
#除了上面用merge方式取得ERP出貨資料, 亦可直接使用sql語法直接讀取出貨資料
#open the ODBC connection
ch <- odbcConnect("N_ERP",uid="sa",pwd="intron")
#台北的資料庫為Icompany8
sqlResult <- sqlQuery(ch, "SELECT
Pact.actDate AS 'shipdate',
Card.no As 'ClientNo',
Card.name AS 'client',
SubShip.name AS 'partno',
vary.amountUI*ship.moneyDB AS 'samt',
Vary.vol*-1 AS 'sqty',
Vary.cost AS 'Runitprice',
vary.vol*vary.cost*-1 AS 'scost',
Ship.agent AS 'salesno',
Card_1.name AS 'salesman'
FROM ICompany8.dbo.Card Card,                                         ICompany8.dbo.Card Card_1,
ICompany8.dbo.Pact Pact,
ICompany8.dbo.Ship Ship,
ICompany8.dbo.SubShip SubShip,                                        ICompany8.dbo.Vary Vary
WHERE Ship.pact = Pact.pact AND                                       Vary.vary = SubShip.vary AND
Vary.pact = Pact.pact AND
Card.card = Ship.who AND
Ship.agent = Card_1.card
AND
((Card.kind=-1) AND
(Pact.ui=30) AND
(Pact.actDate>={ts '2021-01-01 00:00:00'})
)")
#讀取HK資料庫Icompany13
sqlResult13 <- sqlQuery(ch, "SELECT Pact.actDate AS 'shipdate',
Card.no As 'ClientNo',
Card.name AS 'client',
SubShip.name AS 'partno',
vary.amountUI*ship.moneyDB AS 'samt',
Vary.vol*-1 AS 'sqty',
Vary.cost AS 'Runitprice',
vary.vol*vary.cost*-1 AS 'scost',
Ship.agent AS 'salesno',
Card_1.name AS 'salesman'
FROM ICompany13.dbo.Card Card,
ICompany13.dbo.Card Card_1,
ICompany13.dbo.Pact Pact,
ICompany13.dbo.Ship Ship,
ICompany13.dbo.SubShip SubShip,
ICompany13.dbo.Vary Vary
WHERE Ship.pact = Pact.pact AND
Vary.vary = SubShip.vary AND
Vary.pact = Pact.pact AND
Card.card = Ship.who AND
Ship.agent = Card_1.card AND
((Card.kind=-1) AND (Pact.ui=30) AND
(Pact.actDate>={ts '2021-01-01 00:00:00'})
)")
# merge the output of TP and HK
sqlResultall <- rbind(sqlResult, sqlResult13)
# subset the
sqlResultall7 <- subset(sqlResultall, sqlResultall$shipdate >='2021-07-01 00:00:00')
# close the ODBC connection
odbcClose(ch)
# To save the objects (sqlResultall,sqlResultall7) to a RData file
save(sqlResultall,sqlResultall7,  file = "C:/Users/elvis/Documents/fwt_reports/fwtdata.RData")
# To load the data again
#load("C:/Users/elvis/Documents/fwt_reports/fwtdata.RData")
######################
#20210716 This R script will connect the ERP server
#Get shipment records and save to a RData for FWT dashboard
library("writexl")
require(RODBC)
#20180720測試:連結大帳省ERP資料庫
#除了上面用merge方式取得ERP出貨資料, 亦可直接使用sql語法直接讀取出貨資料
#open the ODBC connection
ch <- odbcConnect("N_ERP",uid="sa",pwd="intron")
#台北的資料庫為Icompany8
sqlResult <- sqlQuery(ch, "SELECT
Pact.actDate AS 'shipdate',
Card.no As 'ClientNo',
Card.name AS 'client',
SubShip.name AS 'partno',
vary.amountUI*ship.moneyDB AS 'samt',
Vary.vol*-1 AS 'sqty',
Vary.cost AS 'Runitprice',
vary.vol*vary.cost*-1 AS 'scost',
Ship.agent AS 'salesno',
Card_1.name AS 'salesman'
FROM ICompany8.dbo.Card Card,                                         ICompany8.dbo.Card Card_1,
ICompany8.dbo.Pact Pact,
ICompany8.dbo.Ship Ship,
ICompany8.dbo.SubShip SubShip,                                        ICompany8.dbo.Vary Vary
WHERE Ship.pact = Pact.pact AND                                       Vary.vary = SubShip.vary AND
Vary.pact = Pact.pact AND
Card.card = Ship.who AND
Ship.agent = Card_1.card
AND
((Card.kind=-1) AND
(Pact.ui=30) AND
(Pact.actDate>={ts '2021-01-01 00:00:00'})
)")
#讀取HK資料庫Icompany13
sqlResult13 <- sqlQuery(ch, "SELECT Pact.actDate AS 'shipdate',
Card.no As 'ClientNo',
Card.name AS 'client',
SubShip.name AS 'partno',
vary.amountUI*ship.moneyDB AS 'samt',
Vary.vol*-1 AS 'sqty',
Vary.cost AS 'Runitprice',
vary.vol*vary.cost*-1 AS 'scost',
Ship.agent AS 'salesno',
Card_1.name AS 'salesman'
FROM ICompany13.dbo.Card Card,
ICompany13.dbo.Card Card_1,
ICompany13.dbo.Pact Pact,
ICompany13.dbo.Ship Ship,
ICompany13.dbo.SubShip SubShip,
ICompany13.dbo.Vary Vary
WHERE Ship.pact = Pact.pact AND
Vary.vary = SubShip.vary AND
Vary.pact = Pact.pact AND
Card.card = Ship.who AND
Ship.agent = Card_1.card AND
((Card.kind=-1) AND (Pact.ui=30) AND
(Pact.actDate>={ts '2021-01-01 00:00:00'})
)")
# merge the output of TP and HK
sqlResultall <- rbind(sqlResult, sqlResult13)
# subset the
sqlResultall7 <- subset(sqlResultall, sqlResultall$shipdate >='2021-07-01 00:00:00')
# close the ODBC connection
odbcClose(ch)
# To save the objects (sqlResultall,sqlResultall7) to a RData file
save(sqlResultall,sqlResultall7,  file = "C:/Users/elvis/Documents/fwt_reports/fwtdata.RData")
# To load the data again
#load("C:/Users/elvis/Documents/fwt_reports/fwtdata.RData")
# update the Rmd file
rmarkdown::render("fwt_dashboards.Rmd")
#20210716 This R script will connect the ERP server
#Get shipment records and save to a RData for FWT dashboard
library("writexl")
require(RODBC)
#20180720測試:連結大帳省ERP資料庫
#除了上面用merge方式取得ERP出貨資料, 亦可直接使用sql語法直接讀取出貨資料
#open the ODBC connection
ch <- odbcConnect("N_ERP",uid="sa",pwd="intron")
#台北的資料庫為Icompany8
sqlResult <- sqlQuery(ch, "SELECT
Pact.actDate AS 'shipdate',
Card.no As 'ClientNo',
Card.name AS 'client',
SubShip.name AS 'partno',
vary.amountUI*ship.moneyDB AS 'samt',
Vary.vol*-1 AS 'sqty',
Vary.cost AS 'Runitprice',
vary.vol*vary.cost*-1 AS 'scost',
Ship.agent AS 'salesno',
Card_1.name AS 'salesman'
FROM ICompany8.dbo.Card Card,                                         ICompany8.dbo.Card Card_1,
ICompany8.dbo.Pact Pact,
ICompany8.dbo.Ship Ship,
ICompany8.dbo.SubShip SubShip,                                        ICompany8.dbo.Vary Vary
WHERE Ship.pact = Pact.pact AND                                       Vary.vary = SubShip.vary AND
Vary.pact = Pact.pact AND
Card.card = Ship.who AND
Ship.agent = Card_1.card
AND
((Card.kind=-1) AND
(Pact.ui=30) AND
(Pact.actDate>={ts '2021-01-01 00:00:00'})
)")
#讀取HK資料庫Icompany13
sqlResult13 <- sqlQuery(ch, "SELECT Pact.actDate AS 'shipdate',
Card.no As 'ClientNo',
Card.name AS 'client',
SubShip.name AS 'partno',
vary.amountUI*ship.moneyDB AS 'samt',
Vary.vol*-1 AS 'sqty',
Vary.cost AS 'Runitprice',
vary.vol*vary.cost*-1 AS 'scost',
Ship.agent AS 'salesno',
Card_1.name AS 'salesman'
FROM ICompany13.dbo.Card Card,
ICompany13.dbo.Card Card_1,
ICompany13.dbo.Pact Pact,
ICompany13.dbo.Ship Ship,
ICompany13.dbo.SubShip SubShip,
ICompany13.dbo.Vary Vary
WHERE Ship.pact = Pact.pact AND
Vary.vary = SubShip.vary AND
Vary.pact = Pact.pact AND
Card.card = Ship.who AND
Ship.agent = Card_1.card AND
((Card.kind=-1) AND (Pact.ui=30) AND
(Pact.actDate>={ts '2021-01-01 00:00:00'})
)")
# merge the output of TP and HK
sqlResultall <- rbind(sqlResult, sqlResult13)
# subset the
sqlResultall7 <- subset(sqlResultall, sqlResultall$shipdate >='2021-07-01 00:00:00')
# close the ODBC connection
odbcClose(ch)
# To save the objects (sqlResultall,sqlResultall7) to a RData file
save(sqlResultall,sqlResultall7,  file = "C:/Users/elvis/Documents/fwt_reports/fwtdata.RData")
# To load the data again
#load("C:/Users/elvis/Documents/fwt_reports/fwtdata.RData")
rmarkdown::render("fwt_dashboards.Rmd")
rmarkdown::render("fwt_dashboards.Rmd")
